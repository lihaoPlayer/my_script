# coding: utf-8
# 获取所有硬盘

import os
import glob


class Disks:
    __disks = []

    class Disk:
        def __init__(self, name):
            self.name = name

        @property
        def sys(self):
            return "/sys/block/{}".format(self.name)

        @property
        def dev(self):
            return "/dev/{}".format(self.name)

        @property
        def size(self):
            fp = open(self.dev)
            fp.seek(0, 2)
            return int(fp.tell())

        def is_removable(self):
            path = "{}/removable".format(self.sys)
            txt = open(path).read()
            return txt.strip() == "1"

        def is_virtual(self):
            path = "/sys/devices/virtual/block/{}".format(self.name)
            return os.path.exists(path)

        def __str__(self):
            return self.dev

        def __int__(self):
            return self.size

        def __repr__(self):
            return "<Disk name: {} size: {}>".format(self.dev, self.size)

    @classmethod
    def initialize(cls):
        for block in glob.glob("/sys/block/*"):
            name = os.path.basename(block)
            cls.__disks.append(cls.Disk(name))

    @classmethod
    def disks(cls):
        for d in cls.__disks:
            if os.path.exists(d.dev):
                yield(d)

Disks.initialize()
