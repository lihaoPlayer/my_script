# coding: utf-8
import threading
import subprocess as sp


def ping(host, timeout=2):
    command = ["ping", "-c", "2", "-i", "0.1", "-w", str(timeout), host]
    try:
        sp.check_call(command, stdout=sp.PIPE, stderr=sp.PIPE)
    except sp.CalledProcessError:
        return False
    return True


def ping_thread(host, result, timeout=2):
    result[host] = ping(host, timeout)
    return


def ping_parallel(hosts, timeout=2):
    """并发 ping 所有主机"""
    threads = []
    result = dict()
    for host in hosts:
        thread = threading.Thread(target=ping_thread,
                                  args=(host, result, timeout))
        thread.start()
        threads.append(thread)
    for thread in threads:
        thread.join()
    return result

def is_net_ok():
    return any(
        ping_parallel(
            ['8.8.8.8', '114.114.114.114', 'www.baidu.com']).values())


if __name__ == '__main__':
    # print(ping("8.8.8.8"))
    # print(ping("1.1.1.1"))
    print(ping_parallel(["8.8.8.8", "1.1.1.1", "123.123.13.13", "2.2.2.2"],
                        timeout=10))
    # print(is_net_ok())